# Compact • ST-20251113-act-007-01-entity-design

## Confirmed
- `docs/local_data_model.md` still documents the ER design and detailed column mappings/index plans for all course/section/subscription entities that underpin FR-01/FR-02 (`docs/local_data_model.md:1-335`).
- The derived-field guidance now clarifies that ingest should parse `startTimeMilitary`/`endTimeMilitary` directly whenever available (since many SOC rows omit `pmCode`), and only fall back to the 12h clock—with the previously added 12 AM/PM safeguards—when military values are absent (`docs/local_data_model.md:333`).
- No schema code changes were required; documentation continues to be the single source of truth for the upcoming migration tooling.

## Interface / Behavior Changes
- Ingest logic expectations are updated: parsers must prefer the military-time fields to avoid discarding afternoon/evening slots lacking `pmCode`, ensuring FR-02 time filters remain accurate.

## Self-test
- Documentation update only; no automated/manual tests executed.

## Risks / TODO
- SQLite schema + migration tooling remain unimplemented and must honor these parsing rules when built.
- Future SOC payload shifts (e.g., removal of `pmCode` or format changes) will require revisiting the ingest guidance.

## Code Review - ST-20251113-act-007-01-entity-design - 2025-11-17T05:15:52Z
Codex Review
Here are some automated review suggestions for this pull request.

ℹ️ About Codex in GitHub
docs/local_data_model.md
Comment on lines +332 to +333
- **Credit parsing:** `creditsObject.description` strings like `3.0 Credits` or `BA` are parsed via regex; when parsing fails we set `credits_min`/`credits_max` to `NULL` and flag `tags -> variable_credit = true`.
- **Meeting minutes:** Strings such as `0350` are interpreted as 3:50 PM if `pmCode == 'P'`; convert to 15:50 = 950 minutes via `(int(start[:2]) * 60 + int(start[2:])) + (pmCode == 'P' ? 12*60 : 0)` and mod 24h.

@chatgpt-codex-connector
chatgpt-codex-connector bot

P1 Badge Fix 12 AM/PM handling in meeting time conversion

The derived-field note converts HHMM strings by always adding 12 hours when pmCode == 'P' and taking mod 24 ((int(start[:2]) * 60 + int(start[2:])) + (pmCode == 'P' ? 12*60 : 0)), which misplaces noon and midnight: a 12:00 PM meeting would wrap to 00:00 and a 12:00 AM meeting would be stored at 12:00. Any noon/midnight sections would therefore index at the wrong time, breaking FR-02 time filtering and calendar ordering. The conversion should special-case hour 12 (add 12 only for 1–11 PM; treat 12 AM as 0).

Codex Review
Here are some automated review suggestions for this pull request.

ℹ️ About Codex in GitHub
docs/local_data_model.md

## Derived field notes
- **Credit parsing:** `creditsObject.description` strings like `3.0 Credits` or `BA` are parsed via regex; when parsing fails we set `credits_min`/`credits_max` to `NULL` and flag `tags -> variable_credit = true`.
- **Meeting minutes:** Strings such as `0350` are interpreted as 3:50 PM if `pmCode == 'P'`; convert to 15:50 = 950 minutes via `(int(start[:2]) * 60 + int(start[2:])) + (pmCode == 'P' ? 12*60 : 0)` and mod 24h.
- **Meeting minutes:** Strings such as `0350` are interpreted as 3:50 PM if `pmCode == 'P'`; convert via `hour = int(start[:2]) % 12` (so `12` becomes `0`), `minute = int(start[2:])`, `base = hour * 60 + minute`, then add `12 * 60` only when `pmCode == 'P'`. This keeps 12:00 PM at 720 minutes and 12:00 AM at 0 without wraparound.

@chatgpt-codex-connector
chatgpt-codex-connector bot
 
P1 Badge Meeting-minute formula drops 24h data when pmCode is missing

The new derived-field guidance at docs/local_data_model.md now converts meeting times via hour = int(start[:2]) % 12 and only adds the PM offset when pmCode == 'P'. For SOC rows where startTimeMilitary already contains 24h values but pmCode is blank—about 37% of meetings per docs/soc_field_matrix.csv:74-79—this % 12 step discards the 13–23 hour information and returns AM minutes, so start_minutes/end_minutes for afternoon/evening classes would be wrong and FR-02 time filters would misfire. The previous formula without % 12 handled missing pmCode correctly, so this change regresses those records.

Codex Review: Didn't find any major issues. Already looking forward to the next diff.
